# Forked from Alpine to add systemd!

pkgname=plank
pkgver=0.11.89
pkgrel=0
pkgdesc="Pantheon top panel"
url="https://github.com/elementary/wingpanel"
arch="all !s390x" # no libei-dev for s390x
license="GPL-2.0-or-later"
depends="
	gala
	"
makedepends="
	autoconf
	automake
	gala-dev
	gnome-menus-dev
	libbamf-dev
	libgee-dev
	libwnck3
	glib-dev
	granite-dev
	gnome-common
	intltool
	libxfixes-dev
	pango-dev
	cairo-dev
	mutter46-dev
	vala
	"
# TODO: crossdirect disabled due to armv7 crosscompile failure on x86_64, see
# https://gitlab.com/postmarketOS/pmaports/-/merge_requests/5115#note_1899890119
options="!check !pmb:crossdirect" # Can't be run with release builds
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/ricotz/plank/archive/refs/tags/$pkgver.tar.gz
	applications-Properly-handle-possible-error.patch
"
builddir="$srcdir/$pkgname-$pkgver"

prepare() {
	cd $builddir
	sed 's/0.19.6/0.20/' -i configure.ac
	NOCONFIGURE=1 ./autogen.sh
}

build() {
	./configure \
	--prefix=/usr \
	--sysconfdir=/etc \
	--disable-apport
	sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
	make
}

package() {
	make DESTDIR="${pkgdir}" install
}

sha512sums="
565cc84f8f4b39a2e076ccc9dfe73627f4735d1731e947e0aa94843b5528f67547d59b59e832c7ea32fe6c228cb473f4d841f06e74f7ac4885eff8167cffb52e  plank-0.11.89.tar.gz
b56fb9ef99b4ee5769c9e1b561a47a999dfacf3991a6e6347372f470dc52b3b4da779afc17c6077347b728bd9c381c921d03f5d9478ed6b52c509a140f1eb363  applications-Properly-handle-possible-error.patch
"
